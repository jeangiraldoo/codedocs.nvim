# Technical documentation

Welcome! This document provides an overview of the Codedocs codebase to help you contribute to the project, understand how it works internally, or—let's be honest—to help me when I inevitably forget how things are wired together.

Codedocs is a plugin focused on generating and inserting docstrings for programming language structures. In the context of this plugin, a "structure" refers to any language construct such as functions, methods, classes, or variables.

## Table of contents
- [Components](#components)
- [Logic flow](#logic-flow)

## Components

This a detailed representation of the components and subcomponents that form the plugin:

```mermaid
architecture-beta
    group components(cloud)[Components]

    group node_parser(server)[node_parser] in components
    service parser(server)[parser] in node_parser
    service queries(database)[queries] in node_parser

    group docs_gen(server)[docs_gen] in components
    service builder(server)[builder] in docs_gen
    group styles(database)[styles] in docs_gen

    service langs(database)[langs] in styles
    service manager(server)[manager] in styles

    service writer(server)[writer] in components

    parser:R <-- L:queries
    parser:T --> B:builder
    langs:L --> R:builder
    builder:L --> R:writer
```

### `node_parser`

This directory is responsible for parsing Treesitter nodes and extracting specific data from them (e.g., the parameters of a function node).

```mermaid
architecture-beta
    group node_parser(server)[node_parser]
    service parser(server)[parser] in node_parser
    service queries(database)[queries] in node_parser

    parser:R <-- L:queries
```

- **`queries`**: A directory containing files with Treesitter queries for parsing language constructs such as functions, classes, etc.  
- **`parser`**: A module that detects the programming language in the Neovim buffer, parses the corresponding queries from the `queries` directory, and returns specific data based on the parsed queries.

### `docs_gen`

This directory is responsible for generating a docstring using the data provided by the `node_parser` component.

```mermaid
architecture-beta
    group docs_gen(server)[docs_gen]
    service builder(server)[builder] in docs_gen
    group styles(database)[styles] in docs_gen

    service langs(database)[langs] in styles
    service manager(server)[manager] in styles

    langs:L --> R:builder
```

- **`builder`**: A module that constructs a docstring based on the data parsed by `node_parser` and the language-specific settings defined in `langs`.

#### Styles

- **`langs`**: A directory containing modules for various programming languages. Each module includes customizable settings that define the structure and appearance of a docstring for its respective language.  
- **`manager`**: A module dedicated to modifying the settings in the `langs` directory. It is invoked by the `setup` function in the `init` file, allowing users to customize the default language style or specific settings from a particular style.

### `writer`

The writer module is the final step in Codedoc's workflow. It takes the docstring (represented as a table) generated by docs_gen, writes it to the buffer, and positions the cursor at the title's location. The module then enters Insert mode, allowing users to immediately start typing the title of the docstring.

## Logic flow

The following diagram provides a visual representation of the logic flow that takes place each time docstring generation is triggered, whether through a Codedocs command or a keymap.

```mermaid
flowchart TB
    1((Codedocs<br>triggered)) --> 2
    2[Detect filetype] --> 3
    3{Is there a Treesitter<br>parser installed<br>for the filetype?}
    3 -- No ---> 4[/Inform the user with a message/]
    3 -- Yes ---> 5{Is there a style<br>for the filetype?}
    5 -- No ---> 6[/Inform the user with a message/]
    5 -- Yes ---> 7{Is there a supported<br>structure node<br>under the cursor?}
    7 -- No ---> 8[Insert a generic docstring]
    7 -- Yes ---> 9[Extract data using<br>the appropriate<br>Struct Parser module]
    9 ---> 10[Build the docstring<br>using the corresponding<br>Docstring Builder module]
    10 --> 11((Docstring<br>inserted))
```
